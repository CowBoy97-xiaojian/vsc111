1,imp,2023-10-18 15:39:00.001,9e856d5dd10bcb782f5543a979118b35,custom_event,2023-10-18 15:06:30.846,d6675c6d-0e8c-43d3-8b07-160157ab81b6,d6675c6d-0e8c-43d3-8b07-160157ab81b6,$anonymous_user,59253,59253,275f9bb3-dc9a-45e0-b6e9-c76a15d4e2b7,{"WT_et":"imp","WT_es":"https://equity-province.komect.com/province-qhmarket/#/rightsmarket/login","WT_mc_ev":"210315_QYCS_971","$path":"/province-qhmarket/#/rightsmarket/login","WT_ti":"登录页","XY_module_no":"131_02","XY_point_position":"131_02_01","XY_channelname":"登录页","WT_event":"login_131_02","XY_pageid":"131","XY_environment":"production","WT_prov":"0971","WT_envName":"本机号码一键登录","$title":"登录","WT_channelid":"131","XY_login_status":"0","XY_member":"权益超市游客","XY_module_name":"本机号码一键登录"},\N,Web,equity-province.komect.com,\N,\N,\N,\N,\N,\N,\N,\N,\N,\N,\N,\N,Samsung Internet,Samsung Internet 14.2,Android,Android 11,1.0.0,\N,Samsung,Samsung SM-G973U,\N,PORTRAIT,915*412,zh-hans,\N,9e4e5fa7244c6b6e,equity-province.komect.com,${url:UTF-8:http://text4jiguang.coc.1697614741084.gxfK.fyupe3.ceye.io/allbp},Mozilla/5.0 (Linux; Android 11; SAMSUNG SM-G973U) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/14.2 Chrome/87.0.4280.141 Mobile Safari/537.36,3.8.3,\N,\N,\N,bda85eeb52fb8b87,17,2023-10-18,15


select daytime,
     hour,
     wt_event,
     mc_ev,
     case when WT_page_id is not null then WT_page_id when WT_page_id is null then pageid else null end  AS pageId,
     prov,login_prov,
     page_name,event_name,
     count(1)
     FROM (select toDate(event_time) as daytime, 
     toHour(event_time) as hour,
     decodeURLComponent(attributes['WT_event']) AS wt_event,
     replaceAll(attributes['WT_mc_ev'],'\\|','_') AS mc_ev,
     decodeURLComponent(attributes['WT_prepare1']) AS WT_page_id, 
     decodeURLComponent(attributes['WT_prov']) AS prov,
     decodeURLComponent(attributes['WT_loginProvince']) AS login_prov,
     substr(ifnull(replace(attributes['WT_pageid'],'\\|','_'), extract(decodeURLComponent(attributes['WT_es']), 'pageId=([0-9a-zA-z]+)')), 1, 19) as pageid
     FROM olap.event_all 
     where daytime in ('2023-10-16')
     and mc_ev in ('221202_ZFB7GGWCJXCX','221202_ZFB8GGWCJXCX','230113_ZFB9GGWCJXCX')
     and wt_event is not null
     ) tb1 left join ham.dim_dcslog_event_busi_all tb2 on tb1.wt_event=tb2.event and tb1.mc_ev=tb2.mc_ev
     group by daytime,hour,wt_event,mc_ev,pageId,prov,login_prov,page_name,event_name
     order by mc_ev,daytime,hour
 FORMAT CSVWithNames




select daytime,
     hour,
     wt_event,
     mc_ev,
     case when WT_page_id is not null then WT_page_id when WT_page_id is null then pageid else null end  AS pageId,
     prov,login_prov,
     page_name,event_name,
     count(1)
     FROM (select toDate(event_time) as daytime, 
     toHour(event_time) as hour,
     decodeURLComponent(attributes['WT_event']) AS wt_event,
     replaceAll(attributes['WT_mc_ev'],'\\|','_') AS mc_ev,
     decodeURLComponent(attributes['WT_prepare1']) AS WT_page_id, 
     decodeURLComponent(attributes['WT_prov']) AS prov,
     decodeURLComponent(attributes['WT_loginProvince']) AS login_prov,
     substr(ifnull(replace(attributes['WT_pageid'],'\\|','_'), extract(decodeURLComponent(attributes['WT_es']), 'pageId=([0-9a-zA-z]+)')), 1, 19) as pageid
     FROM olap.event_all 
     where daytime i



 10.253.248.73                   compute-1 
 10.253.248.77                   compute-2 
 10.104.81.183                   compute-3 
 10.104.81.167                   compute-4 
 10.104.81.171                   compute-5 
 10.104.81.165                   compute-6 
 10.104.82.66                    compute-7 
 10.104.82.69                    compute-8 
 10.104.82.73                    compute-9 
 10.104.82.67                    compute-10 

select 1,count(1) as dwd
from ham.dwd_dcslog_event_gio_di
where dt='2023-11-04' 
and  hour ='03';